{{ block "content" . }}
<div class="breadcrumbs text-sm mb-4">
  <ul>
    <li><a href="/">{{i "Home"}}</a></li>
    <li>{{i "Help"}}</li>
  </ul>
</div>

<div class="prose max-w-none">
  <h1>{{i "Project help"}}</h1>

  {{if and .Tasks (eq (len .Tasks) 1)}}
  {{$task := index .Tasks 0}}
  <!-- Progress card -->
  <div class="card bg-base-200 shadow-xl my-6 not-prose">
    <div class="card-body">
      <h3 class="card-title text-base">{{i "Progress"}}</h3>
      <div class="text-xs mb-2">
        {{$task.CompletedCount}}/{{$task.TotalCount}} {{i "eligible"}} ({{$task.PhaseProgress.Total}} {{i "total"}})
      </div>
      {{template "progressBar" $task.PhaseProgress}}

      {{if $task.If}}
      <div class="mt-2">
        <span class="text-xs font-semibold opacity-70">{{i "Dependencies:"}}</span>
        <div class="flex flex-wrap gap-1 mt-1">
          {{range $depTask, $depValue := $task.If}}
          <div class="badge badge-outline badge-sm">{{$depTask}}: {{$depValue}}</div>
          {{end}}
        </div>
      </div>
      {{end}}

      <div class="card-actions justify-end mt-2">
        <a href="/help" class="btn btn-sm btn-ghost">{{i "Back to Overview"}}</a>
        {{if gt $task.AvailableCount 0}}
        <a href="/annotate?task={{$task.ID}}" class="btn btn-sm btn-accent">{{i "Start Annotation"}}</a>
        {{else}}
        <span class="text-xs opacity-70">{{i "All images annotated"}}</span>
        {{end}}
      </div>
    </div>
  </div>
  {{end}}

  <h2>{{i "Description"}}</h2>
  {{if .Description}}
  <div>{{markdown .Description}}</div>
  {{else}}
  <p class="text-base-content/70">{{i "(No description provided)"}}</p>
  {{end}}

  {{if .Task}}
  <!-- Detail view for specific task -->
  <h2>{{i "Phase"}}: {{.Task.ShortName}}</h2>
  <div>{{markdown .Task.Name}}</div>

  <h3>{{i "Possible choices"}}</h3>
  {{range $classID, $class := .Task.Classes}}
  <h4 class="flex items-center gap-2">
    <span>{{if $class.Name}}{{i $class.Name}}{{else}}{{i "(No name)"}}{{end}}</span>
    <span class="badge badge-outline badge-sm not-prose">{{$classID}}</span>
  </h4>
  {{if $class.Description}}
  <div>{{markdown $class.Description}}</div>
  {{else}}
  <p class="text-base-content/70">{{i "(No description provided)"}}</p>
  {{end}}

  {{if $class.Examples}}
  <h5>{{i "Examples"}}</h5>
  {{range $class.Examples}}
  <img src="/asset/{{.}}" alt="Example">
  {{end}}
  {{end}}
  {{end}}
  {{end}}
</div>

{{if .Tasks}}
{{if gt (len .Tasks) 1}}
<div class="mt-8">
  <h2 class="text-2xl font-bold mb-6">{{i "Annotation Phases"}}</h2>

  {{range $index, $task := .Tasks}}
  <div class="mb-6">
    <div class="card bg-base-200 shadow-xl">
      <div class="card-body">
        <h2 class="card-title">
          {{$task.ShortName}}
        </h2>
        <p class="text-sm">{{$task.Name}}</p>

        <div class="mt-3">
          <div class="flex justify-between text-xs mb-1">
            <span class="font-semibold">{{i "Progress"}}</span>
            <span>{{$task.CompletedCount}}/{{$task.TotalCount}} {{i "eligible"}} ({{$task.PhaseProgress.Total}} {{i "total"}})</span>
          </div>
          {{template "progressBar" $task.PhaseProgress}}
        </div>

        {{if $task.If}}
        <div class="mt-2">
          <span class="text-xs font-semibold opacity-70">{{i "Dependencies:"}}</span>
          <div class="flex flex-wrap gap-1 mt-1">
            {{range $depTask, $depValue := $task.If}}
            <div class="badge badge-outline badge-sm">{{$depTask}}: {{$depValue}}</div>
            {{end}}
          </div>
        </div>
        {{end}}

        <div class="card-actions justify-end mt-2">
          <a href="/help/{{$task.ID}}" class="btn btn-sm btn-primary">{{i "View Details"}}</a>
          {{if gt $task.AvailableCount 0}}
          <a href="/annotate?task={{$task.ID}}" class="btn btn-sm btn-accent">{{i "Annotate"}}</a>
          {{end}}
        </div>
      </div>
    </div>

    {{if ne $index (sub (len $.Tasks) 1)}}
    <div class="flex justify-center my-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
      </svg>
    </div>
    {{end}}
  </div>
  {{end}}
</div>
{{end}}
{{end}}
{{ end }}